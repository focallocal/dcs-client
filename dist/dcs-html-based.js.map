{"version":3,"file":"dcs-html-based.js","sources":["../src/utils.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/typeof.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/createClass.js","../node_modules/bellhop-iframe/src/BellhopEventDispatcher.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/node_modules/regenerator-runtime/runtime.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/assertThisInitialized.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/getPrototypeOf.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/superPropBase.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/get.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/setPrototypeOf.js","../node_modules/bellhop-iframe/src/Bellhop.js","../node_modules/bellhop-iframe/node_modules/@babel/runtime/helpers/inherits.js","../src/comToPlugin.js","../src/htmlBased.js","../src/dcs-html-based.js"],"sourcesContent":["//------------------------------------------------------------------------------\r\n\r\nexport const u = {}\r\n\r\n//------------------------------------------------------------------------------\r\n\r\n// Return true if we are in an iframe\r\n// https://stackoverflow.com/a/326076/3567351\r\nu.inIFrame = () => {\r\n  try {\r\n    return window.self !== window.top\r\n  } catch (e) {\r\n    return true\r\n  }\r\n}\r\n\r\n//------------------------------------------------------------------------------\r\n\r\nu.dom = {\r\n  // Resolve when DOM is ready\r\n  onDOMReady() {\r\n    return new Promise(resolve => {\r\n      if (document.readyState !== 'loading') {\r\n        resolve()\r\n      } else {\r\n        document.addEventListener('DOMContentLoaded', resolve)\r\n      }\r\n    })\r\n  },\r\n\r\n  // https://github.com/imagitama/nodelist-foreach-polyfill/blob/master/index.js\r\n  forEach(nodeList, callback, scope) {\r\n    // Duplicate the list, so that we can iterate over a dynamic node list\r\n    // returned by getElementsByClassName() and the likes. If we don't, the\r\n    // following won't work, as we change the list dynamically while we iterate\r\n    // over it:\r\n    // u.dom.forEach(document.getElementsByClassName('toto'), node => node.classList.remove('toto'))\r\n    const list = [...nodeList]\r\n    for (let i = 0; i < list.length; i++) {\r\n      callback.call(scope || window, list[i], i)\r\n    }\r\n  },\r\n\r\n  wrap(el, wrapper) {\r\n    el.parentNode.insertBefore(wrapper, el)\r\n    wrapper.appendChild(el)\r\n    return wrapper\r\n  },\r\n\r\n  wrapAll(elArray, wrapper) {\r\n    if (elArray && elArray.length) {\r\n      // Duplicate the array in case it is a DOM nodeList than would be modified\r\n      // while we move elements\r\n      const copyArray = Array.prototype.slice.call(elArray)\r\n      copyArray[0].parentNode.insertBefore(wrapper, copyArray[0])\r\n      copyArray.forEach(el => wrapper.appendChild(el))\r\n    }\r\n    return wrapper\r\n  },\r\n\r\n  createElement(htmlString) {\r\n    const div = document.createElement('div')\r\n    div.innerHTML = htmlString.trim()\r\n    return div.firstChild\r\n  }\r\n}\r\n\r\n//------------------------------------------------------------------------------\r\n","function _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","/**\n * Function with a added priority type\n * @typedef {Function} PriorityFunction\n * @property {number} _priority\n */\n\n/**\n * Generic event dispatcher\n * @class  BellhopEventDispatcher\n */\nexport class BellhopEventDispatcher {\n  /**\n   *  The collection of event listeners\n   *  @property {Object} _listeners\n   *  @private\n   */\n  constructor() {\n    this._listeners = {};\n  }\n\n  /**\n   *  Add an event listener to the listen to an event from either the parent or iframe\n   *  @method on\n   *  @param {String} name The name of the event to listen\n   *  @param {PriorityFunction} callback The handler when an event is triggered\n   *  @param {number} [priority=0] The priority of the event listener. Higher numbers are handled first.\n   */\n  on(name, callback, priority = 0) {\n    if (!this._listeners[name]) {\n      this._listeners[name] = [];\n    }\n    callback._priority = parseInt(priority) || 0;\n\n    // If callback is already set to this event\n    if (-1 !== this._listeners[name].indexOf(callback)) {\n      return;\n    }\n\n    this._listeners[name].push(callback);\n\n    if (this._listeners[name].length > 1) {\n      this._listeners[name].sort(this.listenerSorter);\n    }\n  }\n\n  /**\n   * @private\n   * @param {PriorityFunction} a\n   * @param {PriorityFunction} b\n   * @returns {number};\n   *  Sorts listeners added by .on() by priority\n   */\n  listenerSorter(a, b) {\n    return a._priority - b._priority;\n  }\n\n  /**\n   *  Remove an event listener\n   *  @method off\n   *  @param {String} name The name of event to listen for. If undefined, remove all listeners.\n   *  @param {Function} [callback] The optional handler when an event is triggered, if no callback\n   *         is set then all listeners by type are removed\n   */\n  off(name, callback) {\n    if (this._listeners[name] === undefined) {\n      return;\n    }\n\n    if (callback === undefined) {\n      delete this._listeners[name];\n      return;\n    }\n\n    const index = this._listeners[name].indexOf(callback);\n\n    -1 < index ? this._listeners[name].splice(index, 1) : undefined;\n  }\n\n  /**\n   *  Trigger any event handlers for an event type\n   *  @method trigger\n   *  @param {object | String} event The event to send\n   *  @param {object} [data = {}] optional data to send to other areas in the app that are listening for this event\n   */\n  trigger(event, data = {}) {\n    if (typeof event == 'string') {\n      event = {\n        type: event,\n        data: 'object' === typeof data && null !== data ? data : {}\n      };\n    }\n\n    if ('undefined' !== typeof this._listeners[event.type]) {\n      for (let i = this._listeners[event.type].length - 1; i >= 0; i--) {\n        this._listeners[event.type][i](event);\n      }\n    }\n  }\n\n  /**\n   * Reset the listeners object\n   * @method  destroy\n   */\n  destroy() {\n    this._listeners = {};\n  }\n}\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","var _typeof = require(\"../helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","var getPrototypeOf = require(\"./getPrototypeOf\");\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nmodule.exports = _superPropBase;","var superPropBase = require(\"./superPropBase\");\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    module.exports = _get = Reflect.get;\n  } else {\n    module.exports = _get = function _get(target, property, receiver) {\n      var base = superPropBase(target, property);\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nmodule.exports = _get;","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","import { BellhopEventDispatcher } from './BellhopEventDispatcher.js';\n\n/**\n *  Abstract the communication layer between the iframe\n *  and the parent DOM\n *  @class Bellhop\n *  @extends BellhopEventDispatcher\n */\nexport class Bellhop extends BellhopEventDispatcher {\n  /**\n   * Creates an instance of Bellhop.\n   * @memberof Bellhop\n   * @param { string | number } id the id of the Bellhop instance\n   */\n  constructor(id = (Math.random() * 100) | 0) {\n    super();\n\n    /**\n     *  The instance ID for bellhop\n     *  @property {string} id\n     */\n    this.id = `BELLHOP:${id}`;\n    /**\n     *  If we are connected to another instance of the bellhop\n     *  @property {Boolean} connected\n     *  @readOnly\n     *  @default false\n     *  @private\n     */\n    this.connected = false;\n\n    /**\n     *  If this instance represents an iframe instance\n     *  @property {Boolean} isChild\n     *  @private\n     *  @default true\n     */\n    this.isChild = true;\n\n    /**\n     *  If we are current trying to connec\n     *  @property {Boolean} connecting\n     *  @default false\n     *  @private\n     */\n    this.connecting = false;\n\n    /**\n     *  If using cross-domain, the domain to post to\n     *  @property {string} origin\n     *  @private\n     *  @default \"*\"\n     */\n    this.origin = '*';\n\n    /**\n     *  Save any sends to wait until after we're done\n     *  @property {Array} _sendLater\n     *  @private\n     */\n    this._sendLater = [];\n\n    /**\n     * The iframe element\n     * @property {HTMLIFrameElement} iframe\n     * @private\n     * @readOnly\n     */\n    this.iframe = null;\n\n    /**\n     * The bound receive function\n     * @property {Function} receive\n     * @private\n     */\n    this.receive = this.receive.bind(this);\n  }\n\n  /**\n   *  The connection has been established successfully\n   *  @event connected\n   */\n\n  /**\n   *  Connection could not be established\n   *  @event failed\n   */\n\n  /**\n   *  Handle messages in the window\n   *  @method receive\n   *  @param { MessageEvent } message the post message received from another bellhop instance\n   *  @private\n   */\n  receive(message) {\n    // Ignore messages that don't originate from the target\n    // we're connected to\n    if (this.target !== message.source) {\n      return;\n    }\n\n    // If this is not the initial connection message\n    if (message.data !== 'connected') {\n      let data = message.data;\n      // Check to see if the data was sent as a stringified json\n      if ('string' === typeof data) {\n        try {\n          data = JSON.parse(data);\n        } catch (err) {\n          console.error('Bellhop error: ', err);\n        }\n      }\n      if (this.connected && 'object' === typeof data && data.type) {\n        this.trigger(data);\n      }\n      return;\n    }\n    // Else setup the connection\n    this.onConnectionReceived(message.data);\n  }\n  /**\n   * @memberof Bellhop\n   * @param {object} message the message received from the other bellhop instance\n   * @private\n   */\n  onConnectionReceived(message) {\n    this.connecting = false;\n    this.connected = true;\n\n    // Be polite and respond to the child that we're ready\n    if (!this.isChild) {\n      this.target.postMessage(message, this.origin);\n    }\n\n    // If we have any sends waiting to send\n    // we are now connected and it should be okay\n    for (let i = 0; i < this._sendLater.length; i++) {\n      const { type, data } = this._sendLater[i];\n      this.send(type, data);\n    }\n    this._sendLater.length = 0;\n\n    // If there is a connection event assigned call it\n    this.trigger('connected');\n  }\n\n  /**\n   *  Setup the connection\n   *  @method connect\n   *  @param {HTMLIFrameElement} iframe The iframe to communicate with. If no value is set, the assumption\n   *         is that we're the child trying to communcate with our window.parent\n   *  @param {String} [origin=\"*\"] The domain to communicate with if different from the current.\n   *  @return {Bellhop} Return instance of current object\n   */\n  connect(iframe, origin = '*') {\n    // Ignore if we're already trying to connect\n    if (this.connecting) {\n      return;\n    }\n\n    // Disconnect from any existing connection\n    this.disconnect();\n\n    // We are trying to connect\n    this.connecting = true;\n\n    // The iframe if we're the parent\n    if (iframe instanceof HTMLIFrameElement) {\n      this.iframe = iframe;\n    }\n\n    // The instance of bellhop is inside the iframe\n    this.isChild = iframe === undefined;\n\n    this.supported = true;\n    if (this.isChild) {\n      // for child pages, the window passed must be a different window\n      this.supported = window != iframe;\n    }\n\n    this.origin = origin;\n\n    window.addEventListener('message', this.receive);\n\n    if (this.isChild) {\n      // No parent, can't connect\n      if (window === this.target) {\n        this.trigger('failed');\n      } else {\n        // If connect is called after the window is ready\n        // we can go ahead and send the connect message\n        this.target.postMessage('connected', this.origin);\n      }\n    }\n  }\n\n  /**\n   *  Disconnect if there are any open connections\n   *  @method disconnect\n   */\n  disconnect() {\n    this.connected = false;\n    this.connecting = false;\n    this.origin = null;\n    this.iframe = null;\n    this.isChild = true;\n    this._sendLater.length = 0;\n\n    window.removeEventListener('message', this.receive);\n  }\n\n  /**\n   *  Send an event to the connected instance\n   *  @method send\n   *  @param {string} type name/type of the event\n   *  @param {*} [data = {}] Additional data to send along with event\n   */\n  send(type, data = {}) {\n    if (typeof type !== 'string') {\n      throw 'The event type must be a string';\n    }\n\n    const message = {\n      type,\n      data\n    };\n\n    if (this.connecting) {\n      this._sendLater.push(message);\n    } else {\n      this.target.postMessage(JSON.stringify(message), this.origin);\n    }\n  }\n\n  /**\n   *  A convenience method for sending and the listening to create\n   *  a singular link to fetching data. This is the same calling send\n   *  and then getting a response right away with the same event.\n   *  @method fetch\n   *  @param {String} event The name of the event\n   *  @param {Function} callback The callback to call after, takes event object as one argument\n   *  @param {Object} [data = {}] Optional data to pass along\n   *  @param {Boolean} [runOnce=false] If we only want to fetch once and then remove the listener\n   */\n  fetch(event, callback, data = {}, runOnce = false) {\n    if (!this.connecting && !this.connected) {\n      throw 'No connection, please call connect() first';\n    }\n\n    const internalCallback = e => {\n      if (runOnce) {\n        this.off(e.type, internalCallback);\n      }\n\n      callback(e);\n    };\n\n    this.on(event, internalCallback);\n    this.send(event, data);\n  }\n\n  /**\n   *  A convience method for listening to an event and then responding with some data\n   *  right away. Automatically removes the listener\n   *  @method respond \n   *  @param {String} event The name of the event\n   *  @param {Object | function | Promise | string} [data = {}] The object to pass back.\n   *  \tMay also be a function; the return value will be sent as data in this case.\n   *  @param {Boolean} [runOnce=false] If we only want to respond once and then remove the listener\n   *  \n   */\n  respond(event, data = {}, runOnce = false) {\n    const bellhop = this; //'this' for use inside async function\n    /** \n     * @ignore \n     */ \n    const internalCallback = async function(event){\n      if (runOnce) {\n        bellhop.off(event, internalCallback);\n      }\n      if(typeof data === 'function'){\n        data = data(); \n      }\n      const newData = await data; \n      bellhop.send(event.type, newData);\n    };\n    this.on(event, internalCallback);\n  }\n\n  /**\n   *  Destroy and don't user after this\n   *  @method destroy\n   */\n  destroy() {\n    super.destroy();\n    this.disconnect();\n    this._sendLater.length = 0;\n  }\n\n  /**\n   *\n   * Returns the correct parent element for Bellhop's context\n   * @readonly\n   * @memberof Bellhop\n   */\n  get target() {\n    return this.isChild ? window.parent : this.iframe.contentWindow;\n  }\n}\n","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","import * as comTypes from './com-types'\r\nimport { Bellhop } from 'bellhop-iframe'\r\nimport { u } from './utils'\r\n\r\nexport const inIFrame = u.inIFrame\r\n\r\nclass ComToPlugin {\r\n\t//----------------------------------------------------------------------------\r\n\r\n\tconstructor() {\r\n\t\tthis._bellhop = new Bellhop()\r\n\t\tthis._timer = null\r\n\t\tthis._onConnected = null\r\n\r\n\t\t// This is called avery time the iframe reloads\r\n\t\tthis._bellhop.on('connected', () => {\r\n\t\t\tif (this._timer) {\r\n\t\t\t\tclearTimeout(this._timer)\r\n\t\t\t\tthis._timer = null\r\n\t\t\t}\r\n\t\t\tthis._onConnected && this._onConnected()\r\n\t\t})\r\n\t}\r\n\r\n\t//----------------------------------------------------------------------------\r\n\r\n\t/**\r\n   * @param {Object} arg\r\n   * @param {string} arg.discourseOrigin\r\n   * @param {OnConnectedCallback} arg.onConnected\r\n   * @param {number} arg.timeout\r\n   * @param {OnTimeoutCallback} arg.onTimeout\r\n   */\r\n\tconnect({ discourseOrigin, onConnected, timeout, onTimeout }) {\r\n\t\tif (!u.inIFrame()) {\r\n\t\t\tthrow new Error('comToPlugin must be used in an iframe')\r\n\t\t}\r\n\t\tthis.disconnect()\r\n\t\tthis._onConnected = onConnected\r\n\t\tthis._timer = timeout\r\n\t\t\t? setTimeout(() => {\r\n\t\t\t\t\tonTimeout && onTimeout()\r\n\t\t\t\t}, timeout)\r\n\t\t\t: null\r\n\t\tthis._bellhop.connect(undefined, discourseOrigin)\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this._timer) {\r\n\t\t\tclearTimeout(this._timer)\r\n\t\t\tthis._timer = null\r\n\t\t}\r\n\t\tthis._bellhop.disconnect()\r\n\t}\r\n\r\n\tisConnected() {\r\n\t\treturn this._bellhop.connected\r\n\t}\r\n\r\n\t//----------------------------------------------------------------------------\r\n\r\n\t/**\r\n   * @callback OnDiscourseRoutePushedCallback\r\n   * @param {RoutePushedParams}\r\n   */\r\n\t/**\r\n   *  @param {OnDiscourseRoutePushedCallback} cb\r\n   */\r\n\tonDiscourseRoutePushed(cb) {\r\n\t\tthis._bellhop.on('m2', e => cb(e.data))\r\n\t}\r\n\r\n\t/**\r\n   * @callback OnCountsChangedCallback\r\n   * @param {Counts}\r\n   */\r\n\t/**\r\n   *  @param {OnCountsChangedCallback} cb\r\n   */\r\n\tonCountsChanged(cb) {\r\n\t\tthis._bellhop.on('m3', e => cb(e.data))\r\n\t}\r\n\r\n\t//----------------------------------------------------------------------------\r\n\r\n\t/**\r\n   * @param {SetRouteParams}\r\n   */\r\n\tpostSetDiscourseRoute({ route, mode, clientContext }) {\r\n\t\tthis._bellhop.send('m4', arguments[0])\r\n\t}\r\n\r\n\t/**\r\n   * @param {RouteProps} props\r\n   */\r\n\tpostSetRouteProps({ category, discourseTitle, error }) {\r\n\t\tthis._bellhop.send('m6', arguments[0])\r\n\t}\r\n\r\n\t/**\r\n   * @param {[Redirect]} redirects\r\n   */\r\n\tpostSetRedirects(redirects) {\r\n\t\tthis._bellhop.send('m7', redirects)\r\n\t}\r\n\r\n\t/**\r\n   * @param {CreateTagsParams}\r\n   */\r\n\tpostCreateDcsTags({ pageName, triggerIds, notificationLevel }) {\r\n\t\tthis._bellhop.send('m8', arguments[0])\r\n\t}\r\n\r\n\t/**\r\n   * @param {CreateTopicParams}\r\n   */\r\n\tpostCreateTopic({\r\n\t\ttitle,\r\n\t\tbody,\r\n\t\tcategory,\r\n\t\tpageName,\r\n\t\ttriggerId,\r\n\t\ttagNotificationLevel\r\n\t}) {\r\n\t\tthis._bellhop.send('m9', arguments[0])\r\n\t}\r\n\r\n\t//----------------------------------------------------------------------------\r\n}\r\n\r\nexport const comToPlugin = new ComToPlugin()\r\n\r\n//==============================================================================\r\n// Better scrolling in iframe\r\n//==============================================================================\r\n\r\n/*\r\nIn an iframe, when user scrolls past the top/bottom of the page with the mouse \r\nwheel, the parent window scrolls instead. This isn't good in Discourse, where\r\nthe iframe is full height on the right.\r\nSo what we need to do os to intercept the wheel event and cancel it before it \r\nis forwarded to the parent window.\r\nNotice that the \"scroll\" event fires *after* scrolling has been done, so it is \r\nuseless in our case\r\n*/\r\n\r\nfunction handleScrollEvent(e, scrollDirection) {\r\n\tif (scrollDirection === 'UP') {\r\n\t\tif (window.scrollY === 0) {\r\n\t\t\te.preventDefault()\r\n\t\t}\r\n\t} else if (scrollDirection === 'DOWN') {\r\n\t\t// Compute the maximum scroll Y value\r\n\t\tconst scrollLimitY =\r\n\t\t\tMath.max(\r\n\t\t\t\tdocument.body.scrollHeight,\r\n\t\t\t\tdocument.body.offsetHeight,\r\n\t\t\t\tdocument.documentElement.clientHeight,\r\n\t\t\t\tdocument.documentElement.scrollHeight,\r\n\t\t\t\tdocument.documentElement.offsetHeight\r\n\t\t\t) - window.innerHeight\r\n\r\n\t\t// However, for an unknown reason, in Firefox and Chrome, window.scrollY\r\n\t\t// never reaches the maximum value but is stuck to 544.567969 when\r\n\t\t// scrollLimitY is 545\r\n\t\tif (window.scrollY > scrollLimitY - 1) {\r\n\t\t\te.preventDefault()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nwindow.addEventListener(\r\n\t'wheel',\r\n\te => {\r\n\t\tif (e.deltaY < 0) {\r\n\t\t\thandleScrollEvent(e, 'UP')\r\n\t\t} else if (e.deltaY > 0) {\r\n\t\t\thandleScrollEvent(e, 'DOWN')\r\n\t\t}\r\n\t},\r\n\t{ passive: false } // Passive is true by default on all scroll-related events under Chrome and Firefox\r\n)\r\n\r\ndocument.addEventListener('keydown', e => {\r\n\tif (e.shiftKey || e.altKey || e.ctrlKey || e.metaKey) {\r\n\t\treturn\r\n\t}\r\n\tif (e.code === 'ArrowUp' || e.code === 'PageUp') {\r\n\t\thandleScrollEvent(e, 'UP')\r\n\t}\r\n\tif (e.code === 'ArrowDown' || e.code === 'PageDown') {\r\n\t\thandleScrollEvent(e, 'DOWN')\r\n\t}\r\n})\r\n\r\n//==============================================================================\r\n","import { u } from './utils'\r\nimport { comToPlugin } from './comToPlugin'\r\n\r\n//==============================================================================\r\n//==============================================================================\r\n//==============================================================================\r\n\r\nexport { u, comToPlugin }\r\n\r\n//==============================================================================\r\n//==============================================================================\r\n//==============================================================================\r\n\r\nconst TRIGGER_CLICK_TARGETS =\r\n  '.dcs-icons, .dcs-trigger.dcs-no-balloon .dcs-trigger-span, .dcs-trigger.dcs-no-balloon.dcs-no-span'\r\n\r\n//==============================================================================\r\n//==============================================================================\r\n//==============================================================================\r\n\r\nclass HtmlBasedSingleton {\r\n  //----------------------------------------------------------------------------\r\n\r\n  constructor() {\r\n    this.selTriggerNode = null\r\n    this.resizeTimer = null\r\n    this.currentRoute = null\r\n    comToPlugin.onDiscourseRoutePushed(this._onDiscourseRoutePushed.bind(this))\r\n    comToPlugin.onCountsChanged(({ counts }) => console.log('counts: ', counts))\r\n  }\r\n\r\n  //----------------------------------------------------------------------------\r\n\r\n  connect({ discourseOrigin, timeout }) {\r\n    return new Promise((resolve, reject) => {\r\n      // Establish communication with the Discourse plugin\r\n      this.resolveConnect = resolve\r\n      comToPlugin.connect({\r\n        discourseOrigin,\r\n        timeout,\r\n        onTimeout: () => reject('timeout')\r\n      })\r\n    })\r\n  }\r\n\r\n  //----------------------------------------------------------------------------\r\n\r\n  parseDom({ descr, pageName, discourseOrigin, counts }) {\r\n    // We will resolve all links to absolute without proxy (\"https://website.com/bar/index.html\")\r\n    // We start by retrieving the url of the current page url without the proxy\r\n    const page = descr.pages.find(p => p.name === pageName)\r\n\r\n    // Attempt to support more dynamic websites: manage links and trigger that\r\n    // are added later through javascript\r\n    new MutationObserver(mutationsList => {\r\n      for (let mutation of mutationsList) {\r\n        for (let addedNode of mutation.addedNodes) {\r\n          // We are interested about nodes only (not text, etc.)\r\n          if (addedNode.nodeType !== Node.ELEMENT_NODE) {\r\n            return\r\n          }\r\n\r\n          // Go through added links\r\n          const links = [\r\n            ...(addedNode.tagName === 'A' ? [addedNode] : []),\r\n            ...addedNode.getElementsByTagName('A')\r\n          ]\r\n          for (let a of links) {\r\n            console.log(\r\n              'Docuss experimental feature: a link has been dynamically added',\r\n              a\r\n            )\r\n            this._transformLink({ a, descr, discourseOrigin, page })\r\n          }\r\n\r\n          // Go through added click targets\r\n          const targets = [\r\n            ...(addedNode.matches(TRIGGER_CLICK_TARGETS) ? [addedNode] : []),\r\n            ...addedNode.querySelectorAll(TRIGGER_CLICK_TARGETS)\r\n          ]\r\n          for (let t of targets) {\r\n            // Case a trigger target has been dynamically added\r\n            console.log(\r\n              'Docuss experimental feature: a trigger target has been dynamically added',\r\n              t\r\n            )\r\n            this._addTriggerClickEvent({ node: t, pageName })\r\n          }\r\n\r\n          // Check if triggers have been added\r\n          const triggers = [\r\n            ...(addedNode.classList.contains('dcs-trigger') ? [addedNode] : []),\r\n            ...addedNode.getElementsByClassName('dcs-trigger')\r\n          ]\r\n          if (triggers.length) {\r\n            // Case one or several trigger nodes have been dynamically added\r\n            console.log(\r\n              'Docuss experimental feature: one or several triggers have been dynamically added',\r\n              triggers\r\n            )\r\n            _setAdditionalRedirects()\r\n          }\r\n        }\r\n      }\r\n    }).observe(document.documentElement, { childList: true, subtree: true })\r\n\r\n    // Case click nowhere special (all Docuss specific events ar handles\r\n    // elsewhere with preventDefault)\r\n    window.addEventListener('click', () => {\r\n      // Don't deselect when user is selecting text\r\n      if (\r\n        !window.getSelection().toString() &&\r\n        this.selTriggerNode &&\r\n        this.selTriggerNode.dataset.dcsHighlightable\r\n      ) {\r\n        this._selectTriggers(null)\r\n        comToPlugin.postSetDiscourseRoute({\r\n          route: { layout: 0, pageName },\r\n          mode: 'PUSH',\r\n          clientContext: true\r\n        })\r\n      }\r\n    })\r\n\r\n    // Resize event with debounce\r\n    // https://developer.mozilla.org/en-US/docs/Web/Events/resize#setTimeout\r\n    window.addEventListener('resize', evt => {\r\n      if (this.resizeTimer !== null) {\r\n        clearTimeout(this.resizeTimer)\r\n      }\r\n      this.resizeTimer = setTimeout(() => {\r\n        this.resizeTimer = null\r\n        if (this.selTriggerNode) {\r\n          _scrollIntoViewIfNeeded(this.selTriggerNode)\r\n        }\r\n      }, 100)\r\n    })\r\n\r\n    return u.dom.onDOMReady().then(() => {\r\n      // Modify the document links so that they open the correct url in the\r\n      // correct place\r\n      u.dom.forEach(document.getElementsByTagName('a'), a => {\r\n        this._transformLink({ a, descr, discourseOrigin, page })\r\n      })\r\n\r\n      // Add click events on triggers\r\n      u.dom.forEach(document.querySelectorAll(TRIGGER_CLICK_TARGETS), node => {\r\n        this._addTriggerClickEvent({ node, pageName })\r\n      })\r\n\r\n      // Set the additional redirects\r\n      _setAdditionalRedirects()\r\n\r\n      this.runReady = true\r\n\r\n      if (this.delayedRoute) {\r\n        this._onDiscourseRoutePushed({ route: this.delayedRoute })\r\n      }\r\n    })\r\n  }\r\n\r\n  //----------------------------------------------------------------------------\r\n\r\n  _onDiscourseRoutePushed({ route, descr, counts, clientContext, origin }) {\r\n    this.currentRoute = route\r\n\r\n    // Case init\r\n    if (this.resolveConnect) {\r\n      this.resolveConnect({\r\n        descr,\r\n        pageName: route.pageName,\r\n        discourseOrigin: origin,\r\n        counts\r\n      })\r\n      delete this.resolveConnect\r\n      this.runReady = false\r\n      this.delayedRoute = route\r\n      return\r\n    }\r\n\r\n    // Case we're still not ready\r\n    if (!this.runReady) {\r\n      this.delayedRoute = route\r\n      return\r\n    }\r\n\r\n    // clientContext === true means that this route changed has been\r\n    // triggered by us, so there is nothing more we need to do (because the\r\n    // trigger is already selected)\r\n    if (!clientContext) {\r\n      this._selectTriggers(route.triggerId)\r\n    }\r\n\r\n    // Set the route category and title\r\n    if (route.layout === 2 || route.layout === 3) {\r\n      const category =\r\n        (this.selTriggerNode && this.selTriggerNode.dataset.dcsCategory) ||\r\n        document.documentElement.dataset.dcsCategory\r\n      const discourseTitle =\r\n        (this.selTriggerNode &&\r\n          this.selTriggerNode.dataset.dcsDiscourseTitle) ||\r\n        document.documentElement.dataset.dcsDiscourseTitle\r\n      comToPlugin.postSetRouteProps({ category, discourseTitle })\r\n    }\r\n  }\r\n\r\n  //----------------------------------------------------------------------------\r\n\r\n  _addTriggerClickEvent({ node, pageName }) {\r\n    node.addEventListener('click', e => {\r\n      // Don't do anything if user is selecting text\r\n      if (window.getSelection().toString()) {\r\n        return\r\n      }\r\n\r\n      const triggerNode = e.target.closest('.dcs-trigger')\r\n      const triggerId = triggerNode.dataset.dcsTriggerId\r\n\r\n      this._selectTriggers(triggerId)\r\n\r\n      comToPlugin.postSetDiscourseRoute({\r\n        route: {\r\n          layout: 3,\r\n          pageName: triggerNode.dataset.dcsPageName || pageName,\r\n          triggerId,\r\n          interactMode: triggerNode.dataset.dcsInteractMode\r\n        },\r\n        mode: 'PUSH',\r\n        clientContext: true\r\n      })\r\n\r\n      // Mandatory because we want our global click event to fire only\r\n      // when user clicks on an empty space\r\n      e.stopPropagation()\r\n    })\r\n  }\r\n\r\n  //----------------------------------------------------------------------------\r\n\r\n  // Remember there can be more than one trigger per triggerId\r\n  _selectTriggers(triggerId) {\r\n    if (!this.runReady) {\r\n      throw new Error('should be ready')\r\n    }\r\n\r\n    // Unselect everything\r\n    this.selTriggerNode = null\r\n    u.dom.forEach(document.getElementsByClassName('dcs-highlighted'), node =>\r\n      node.classList.remove('dcs-highlighted')\r\n    )\r\n\r\n    // Case there is nothing to select\r\n    if (!triggerId) {\r\n      return\r\n    }\r\n\r\n    // Look for the trigger node in the DOM\r\n    const triggerNodes = document.querySelectorAll(\r\n      `.dcs-trigger[data-dcs-trigger-id=\"${triggerId}\"]`\r\n    )\r\n\r\n    // Case tag not found\r\n    if (!triggerNodes.length) {\r\n      comToPlugin.postSetRouteProps({ error })\r\n      return\r\n    }\r\n\r\n    // Go through selected nodes\r\n    this.selTriggerNode = null\r\n    u.dom.forEach(triggerNodes, node => {\r\n      // Is it a highlightable trigger node?\r\n      if (node.dataset.dcsHighlightable) {\r\n        // Highlight the trigger nodes\r\n        node.classList.add('dcs-highlighted')\r\n\r\n        // Highlight the subsec nodes\r\n        const subsec = node.closest('.dcs-subsec')\r\n        subsec && subsec.classList.add('dcs-highlighted')\r\n\r\n        // Set one node as the selected one, with priority given to the first\r\n        // dcsHighlightable one. THIS IS IMPORTANT: the selected node must be a\r\n        // dcsHighlightable one for the default click handler to work correctly.\r\n        this.selTriggerNode = this.selTriggerNode || node\r\n      }\r\n    })\r\n\r\n    // Case no dcsHighlightable has been found: take the first node\r\n    this.selTriggerNode = this.selTriggerNode || triggerNodes[0]\r\n\r\n    // Bring the selected node into view\r\n    // THIS IS REQUIRED WHEN LAYOUT HAS CHANGED, BUT ALSO WHEN USING THE BACK\r\n    // BUTTON TO A PREVIOUSLY SELECTED HEADING FAR AWAY\r\n    // Need a setTimeout, to ensure the layout change has occurred.\r\n    // 200 is the iframes animation duration + 30 for security\r\n    // +300 because some web sites (ex: VueJS API) have an animation when layout\r\n    // changes from narrow to wide screen.\r\n    setTimeout(() => _scrollIntoViewIfNeeded(this.selTriggerNode), 700)\r\n  }\r\n\r\n  //----------------------------------------------------------------------------\r\n\r\n  // Something to remember here: a.href and a.getAttribute('href') are two very\r\n  // different things:\r\n  // - a.getAttribute('href') is the absolute or relative url the web designer\r\n  // has written in his html code.\r\n  // - a.href is the resulting absolute url computed by the browser from the\r\n  // a.getAttribute('href') and the current page url.\r\n  _transformLink({ a, descr, discourseOrigin, page }) {\r\n    // Case link is empty\r\n    if (\r\n      !a.href ||\r\n      a.href === '#' ||\r\n      a.href === '#!' || // Yes, some people use this for empty links!\r\n      a.href.startsWith('javascript:')\r\n    ) {\r\n      return\r\n    }\r\n\r\n    // Remove unsupported targets\r\n    if (a.target === '_parent' || a.target === '_top') {\r\n      delete a.target\r\n    }\r\n\r\n    // Transform the \"//discourse\" placeholder by the full link to the\r\n    // Discourse instance\r\n    if (a.hostname === 'discourse') {\r\n      a.href = new URL(a.pathname + a.search + a.hash, discourseOrigin)\r\n    }\r\n\r\n    /*\r\n    There are 3 cases here:\r\n\r\n    Case #1: the link points to another page of our website, such as\r\n    http://my.website.com/otherpage.html. In that case we need to modify the \r\n    link in the DOM to make it point to the Discourse instance, so that \r\n    \"right click + open in a new tab\" will behave correctly. Also, in case of \r\n    single click, we need to cancel the default behavior and ask the Docuss \r\n    plugin to perform the page change within Discourse.\r\n    WE DON'T SUPPORT LINKS USING A DOCUSS PROXY, such as\r\n    http://docuss.proxy.com/http://my.website.com/otherpage.html\r\n\r\n    Case #2: the link is a Discourse link, such as http://my.discourse.com\r\n    or http://my.discourse.com/latest or http://my.discourse.com/docuss/foo.\r\n    There is no need to modify the link in the dom because it is already ok\r\n    for \"right click + open in a new tab\". However, in case of single click,\r\n    we need to cancel the default behavior and ask the Docuss plugin to\r\n    perform the page change within Discourse.\r\n\r\n    Case #3: the link points to an arbitrary external page, such as\r\n    http://google.com. In that case, we just want the link to open in the\r\n    parent window, not the iframe.\r\n    */\r\n\r\n    // Look if the link url is in the website page list (case #1)\r\n    const pageUrlWithoutProxy = page.url\r\n    const possibleRelativeLink = a.getAttribute('href').trim()\r\n    const targetUrlNoProxy = new URL(possibleRelativeLink, pageUrlWithoutProxy)\r\n    targetUrlNoProxy.hash = ''\r\n    const websitePage = descr.pages.find(\r\n      p => p.url.split('#')[0] === targetUrlNoProxy.href\r\n    )\r\n\r\n    // Case #3\r\n    if (!websitePage && a.origin !== discourseOrigin) {\r\n      if (a.target !== '_blank') {\r\n        a.target = '_parent'\r\n      }\r\n      return\r\n    }\r\n\r\n    // Cases #1 and #2\r\n    let route\r\n    if (websitePage) {\r\n      // Case #1\r\n      a.href = discourseOrigin + '/docuss/' + websitePage.name + a.hash\r\n      route = { layout: 0, pageName: websitePage.name, hash: a.hash }\r\n    } else {\r\n      // Case #2 (a.origin === discourseOrigin)\r\n      if (a.pathname.startsWith('/docuss/')) {\r\n        const pageName = a.pathname.substring('/docuss/'.length)\r\n        route = { layout: 0, pageName, hash: a.hash }\r\n      } else if (a.pathname === '/' || a.pathname === '/docuss') {\r\n        // We don't have access to the first website descr, so we cannot\r\n        // compute the target page name. So those 2 lines are very WRONG:\r\n        //    const pageName = descr.pages[0].name\r\n        //    route = { layout: 0, pageName, hash: a.hash }\r\n        // because it would route the user to the first page of the current,\r\n        // descr not the first page of all descr.\r\n        if (a.target !== '_blank') {\r\n          a.target = '_parent'\r\n        }\r\n        return\r\n      } else {\r\n        route = { layout: 1, pathname: a.pathname, hash: a.hash }\r\n      }\r\n    }\r\n\r\n    if (a.target === '_blank') {\r\n      return\r\n    }\r\n\r\n    // Cases #1 and #2\r\n    a.addEventListener('click', e => {\r\n      if (e.ctrlKey) {\r\n        return\r\n      }\r\n\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n\r\n      // Special case when the link is a link to self. On a standard html page,\r\n      // a link to self is supposed to reload the page EXCEPT if there is an\r\n      // anchor, in which case the link acts as if it was a pure anchor link.\r\n      // One thing to take into account here is that the Docuss plugin doesn't\r\n      // support page reloading: if you call postSetDiscourseRoute() with the\r\n      // same route pageName, the page won't reload (but the hash will be set).\r\n      // So what are we gonna do?:\r\n      // - Not reloading the page is ok. I see no point in doing it. Although\r\n      // it could easily be done by setting a.target = '_parent'.\r\n      // - Scroll to the anchor must be taken care of.\r\n      if (route.pageName === page.name) {\r\n        location.hash = a.hash\r\n        const route = Object.assign({}, this.currentRoute, { hash: a.hash })\r\n        comToPlugin.postSetDiscourseRoute({\r\n          route,\r\n          mode: 'REPLACE',\r\n          clientContext: true\r\n        })\r\n      } else {\r\n        comToPlugin.postSetDiscourseRoute({\r\n          route,\r\n          mode: 'PUSH',\r\n          clientContext: true\r\n        })\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n//==============================================================================\r\n//==============================================================================\r\n//==============================================================================\r\n\r\nfunction _scrollIntoViewIfNeeded(target) {\r\n  const rect = target.getBoundingClientRect()\r\n  // https://stackoverflow.com/a/22480938/3567351\r\n  const isPartiallyVisible = rect.top < window.innerHeight && rect.bottom >= 0\r\n  if (!isPartiallyVisible) {\r\n    // Scroll the element to the top of the window\r\n    target.scrollIntoView()\r\n\r\n    // Lower it a little bit, so that there is a nice margin between the element\r\n    // and the top of the window.\r\n    // NO, DON'T DO THAT! Suppose the element is at the bottom of the page: it\r\n    // cannot be scrolled to the top, so lowering it will make it disappear!\r\n    //window.scrollBy(0, -50)\r\n  }\r\n}\r\n\r\n//==============================================================================\r\n//==============================================================================\r\n//==============================================================================\r\n\r\nfunction _setAdditionalRedirects() {\r\n  // Remember that a same triggerId can have several node with different\r\n  // dcsHighlightable property value. So we consider a trigger as\r\n  // highligthable if any of its nodes is highligthable\r\n  const nodes = document.getElementsByClassName('dcs-trigger')\r\n  const highlightables = {}\r\n  u.dom.forEach(nodes, node => {\r\n    const triggerId = node.dataset.dcsTriggerId\r\n    highlightables[triggerId] =\r\n      highlightables[triggerId] || !!node.dataset.dcsHighlightable\r\n  })\r\n  const nonHighlitghables = Object.keys(highlightables).filter(\r\n    id => !highlightables[id]\r\n  )\r\n\r\n  // Here you might be tempted, if there are only nonHighlitghables\r\n  // triggers in the page, to set a single generic redirect instead of one\r\n  // redirect per trigger. Don't do that. Imagine the consequence if the\r\n  // page already contains a static redirect for full page commenting\r\n  // (WITH_SPLIT_BAR => FULL_CLIENT). Yep, infinite loop.\r\n  const redirects = nonHighlitghables.map(triggerId => ({\r\n    src: { layout: 2, triggerId },\r\n    dest: { layout: 0, pageName: '@SAME_AS_SRC@' }\r\n  }))\r\n  comToPlugin.postSetRedirects(redirects)\r\n}\r\n\r\n//==============================================================================\r\n//==============================================================================\r\n//==============================================================================\r\n\r\nexport const htmlBased = new HtmlBasedSingleton()\r\n\r\n//==============================================================================\r\n//==============================================================================\r\n//==============================================================================\r\n\r\n/*\r\nsetTimeout(() => {\r\n  const a1 = u.dom.createElement(`<div><a href=\"DISCOURSE/latest\">Link1 - Latest</a></div>`)\r\n  document.body.appendChild(a1)\r\n\r\n  const t = u.dom.createElement(`\r\n    <div>\r\n      <div style=\"padding: 10px 0px\" data-dcs-trigger-id=\"photos\" data-dcs-interact-mode=\"COMMENT\" data-dcs-discourse-title=\"Additional\" data-dcs-highlightable=\"true\" class=\"dcs-trigger\">\r\n        <span class=\"dcs-trigger-span\">Photos 2</span>\r\n        <span class=\"dcs-icons\">\r\n          <div class=\"dcs-balloon\"></div>\r\n        </span>\r\n      </div>\r\n    </div>\r\n  `)\r\n  document.body.appendChild(t)\r\n\r\n  const a2 = u.dom.createElement(`<a href=\"index.html\">Link2 - Home</a>`)\r\n  document.body.appendChild(a2)\r\n}, 5000)\r\n*/\r\n","import { htmlBased } from './htmlBased'\r\n\r\nhtmlBased.connect({ discourseOrigin: '*', timeout: 10000 }).then(\r\n  args => {\r\n    htmlBased.parseDom(args)\r\n  },\r\n  e => logError('Unable to connect to dcs-discourse-plugin', e)\r\n)\r\n"],"names":["u","inIFrame","window","self","top","e","dom","onDOMReady","Promise","resolve","document","readyState","addEventListener","[object Object]","nodeList","callback","scope","list","i","length","call","wrap","el","wrapper","parentNode","insertBefore","appendChild","elArray","copyArray","Array","prototype","slice","forEach","htmlString","div","createElement","innerHTML","trim","firstChild","_typeof2","obj","Symbol","iterator","constructor","_typeof","module","instance","Constructor","TypeError","_defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","BellhopEventDispatcher","_listeners","name","priority","this","_priority","parseInt","indexOf","push","sort","listenerSorter","a","b","index","splice","event","data","type","runtime","exports","undefined","Op","hasOwn","hasOwnProperty","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","create","context","Context","_invoke","state","GenStateSuspendedStart","method","arg","GenStateExecuting","Error","GenStateCompleted","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","done","GenStateSuspendedYield","value","fn","err","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","defineIteratorMethods","AsyncIterator","previousPromise","callInvokeWithMethodAndArg","reject","invoke","result","__await","then","unwrapped","error","return","info","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","displayName","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","async","iter","toString","keys","object","reverse","pop","skipTempReset","prev","charAt","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode","Function","ReferenceError","assertThisInitialized","_getPrototypeOf","o","property","_get","receiver","Reflect","get","base","superPropBase","desc","getOwnPropertyDescriptor","_setPrototypeOf","p","Bellhop","id","Math","random","connected","isChild","connecting","origin","_sendLater","iframe","receive","_this","bind","subClass","superClass","message","source","onConnectionReceived","JSON","parse","console","trigger","postMessage","send","disconnect","HTMLIFrameElement","supported","removeEventListener","stringify","runOnce","on","internalCallback","_this2","off","bellhop","newData","parent","contentWindow","comToPlugin","_bellhop","_timer","_onConnected","clearTimeout","discourseOrigin","onConnected","timeout","onTimeout","setTimeout","connect","cb","route","mode","clientContext","arguments","category","discourseTitle","redirects","pageName","triggerIds","notificationLevel","title","body","triggerId","tagNotificationLevel","handleScrollEvent","scrollDirection","scrollY","preventDefault","scrollLimitY","max","scrollHeight","offsetHeight","documentElement","clientHeight","innerHeight","deltaY","passive","shiftKey","altKey","ctrlKey","metaKey","code","TRIGGER_CLICK_TARGETS","_scrollIntoViewIfNeeded","rect","getBoundingClientRect","bottom","scrollIntoView","_setAdditionalRedirects","nodes","getElementsByClassName","highlightables","node","dataset","dcsTriggerId","dcsHighlightable","filter","map","src","layout","dest","postSetRedirects","htmlBased","selTriggerNode","resizeTimer","currentRoute","onDiscourseRoutePushed","_onDiscourseRoutePushed","onCountsChanged","counts","log","resolveConnect","descr","page","pages","find","MutationObserver","mutationsList","mutation","addedNode","addedNodes","nodeType","Node","ELEMENT_NODE","links","tagName","getElementsByTagName","_transformLink","targets","matches","querySelectorAll","t","_addTriggerClickEvent","triggers","classList","contains","observe","childList","subtree","getSelection","_selectTriggers","postSetDiscourseRoute","evt","runReady","delayedRoute","dcsCategory","dcsDiscourseTitle","postSetRouteProps","triggerNode","closest","dcsPageName","interactMode","dcsInteractMode","stopPropagation","remove","triggerNodes","add","subsec","href","startsWith","hostname","URL","pathname","search","hash","pageUrlWithoutProxy","url","possibleRelativeLink","getAttribute","targetUrlNoProxy","websitePage","split","substring","location","assign","args","parseDom","logError"],"mappings":"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"}